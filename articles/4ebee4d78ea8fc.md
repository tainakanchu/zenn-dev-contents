---
title: "react-native x asdf の構成のプロジェクトを bitrise でビルドするときの個人的ベストプラクティス"
emoji: "💎"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["bitrise", "reactnative", "asdf"]
published: false
---

# これはなに
弊社では react-native で作成したモバイルアプリを bitrise でビルドしています。このような構成で開発するとき、開発ツールチェーンをどのように管理するかというのは課題であり、社内の各プロダクト様々な方法で管理しています。
特に iOS のビルドに使用する ruby のバージョン管理はいろいろとハマりポイントも多く、社内でも度々話題になっていました。

ここで、2023年6月のアップデートにより、 bitrise の内部的な ruby のバージョン管理が asdf で行われるように変更されました。
https://discuss.bitrise.io/t/xcode-14-2-x-stack-update-2023-06-21-apple-silicon-only/22926

私が参画しているプロダクトでそれに追従する形で asdf での一本化管理に移行したため、その際に検討した点を含めてベストプラクティスとしてまとめます。

# 最終的な .tool-versions のファイルの中身
```
nodejs 18.18.2
yarn 1.22.19
ruby 3.1.6
```

# 前提
## ruby のバージョンを指定するときの辛いポイント
iOS アプリをビルドする場合には ruby が必要であり、rubyのバージョンは開発環境とビルド環境で固定したいニーズがあります。
固定する方法として、 `.ruby-version` を作製して rbnev 経由で指定する方法があります。

```.ruby-version
3.1.2
```

という記述をすればそのプロジェクト以下での ruby はそのバージョンを向くというような作りです。

一方でこの手法にはつらい面があります。`.ruby-version` で指定したバージョンがビルドに使用している bitrise の Stack に含まれていないバージョンだった時、rubyが使用できずビルドが落ちます。

ここで `.ruby-version` にマイナーバージョンまでしか書かないという選択肢も存在します。すなわち、 `ruby-version` を以下のように書きます

```.ruby-version
3.1
```

この場合、bitrise の stack の中で 3.1 に対してエイリアスが貼られており、使用可能な 3.1.x 系のバージョンが使用されます。
このような指定の場合は前述のように
また、マイナーバージョンまで厳密に指定したいというケースにおいてはこのパターンは使用できません


# 管理対象として検討したいツールチェーン
## Node.js
これは react-native の開発に必須なので

## yarn (ないし npmパッケージマネージャー)

## ruby


# bitrise でバージョン指定をする際の注意点
bitrise の各種スタックには

プリンストールされていないバージョンを指定する場合は、ビルドの過程でインストールする時間が発生します。
こけたりすることはないのですが、ビルド時間が長くなるので、プリインストールされているバージョンを指定できた方が望ましいです。

## バージョンをエイリアス指定するかどうか


