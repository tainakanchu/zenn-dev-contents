---
title: "Google カレンダーに自動でフライト情報を登録するメールを手動で作成する"
emoji: "🤖"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: [Gmail]
published: false
---

航空券予約時に、 Google カレンダーに予約したフライトの情報が同期されていて驚かれた経験がある方はいらっしゃいますでしょうか。この内容はメールの内容からスクレイピングのように取得しているわけではなく、予約メールにJSON-LDメタデータを付記することで実現されています。

https://developers.google.com/gmail/markup/reference/flight-reservation

航空会社や旅行代理店によっては予約完了時のメールにこの記述が含まれていてそのままGoogleカレンダーに連携されますが、対応されていない会社も多いのが現状です。そんな場合でもこのフォーマットに沿ったメールを自分で作成して自分で送ることで自動でGoogleカレンダーに登録することができます。その方法をまとめました。

# なぜ自動登録させたいのか
実際に送る方法の前に、なぜ自動登録させたいかについて話しておきます。
カレンダー上にフライト情報を登録しておくだけであれば Google カレンダーに手動で予定を作ってもよいわけです。ただ今回あえて面倒臭い方法を経て自動登録をさせようといています。理由としては大きく以下のメリットを感じているからです。


## Google カレンダー上での見え方が違う
以下のように、Google カレンダーのアプリ上での見え方が変わります。カレンダーの予定の中にフライト時間や必要な予約情報が含まれているので空港で参照する時楽です。

:::message
予約メールへの参照もありますが、手動で作成した場合はもちろん今回作成する中身のないメールが参照先にはなってしまいます。
:::

## ○○○と連携されたフライト情報が参照できる
このように自動設定された予定の中の記述ですが、○○の情報と連携されており、出発地のターミナル情報やフライト時間の変更等の情報がGoogleカレンダー上から閲覧できます。とくにフライト時間の変更の通知は優秀で、空港のボードを見たりアナウンスを聞いたりする前に時間変更を知ることができます。時間変更が通知されてくるのは毎度ギリギリのスケジュールで空港に到着する私にとってはとても助かっている機能です。

# 自動登録されるメールを自分に送る
そんな便利自動登録メールを自分に送る方法を紹介します。ステップとしては

- メタデータ (JSON-LD) の作成
- メールの送信

というシンプルなものです。

## JSON-LD を作成する
前述の仕様に合わせて JSON-LD メタデータを作成します。

必要な情報は
- 出発地到着地の空港・時間情報
- 予約番号


```json
{}
```


このJSONが肝になってきますが、空港名やタイムスタンプ等を漏れなく手で作成するのは地味に面倒だったので作成を支援するWebアプリを作りました。


https://manual-auto-flight-mail.vercel.app/


アプリのフォームに必要な内容を入力することで必要な情報が含まれたJSONを作成します。このJSONを次の工程で使用します。

:::message
空港の入力は現時点では空港コードのみ対応しています。空港コードが不明な場合は~~覚えて~~ググってください
:::


## Google Apps Script で送信する

今回は Google Apps Script 経由で送信をしましたが、 JSON-LD を含むHTMLメールを送信できる方法であればどんな方法でも良いと思います。

:::message
前述のサイトから node-mailer でそのままメール送信する方法も検討して試しましたが、現状うまくいっていません。
:::




# 最後に
特に、フライト予定の遅延情報を参考にした結果乗り遅れたということのないよう、乗り遅れには十分注意し、空港には十分な余裕を持って到着してください。